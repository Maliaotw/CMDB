{% extends 'base.html' %}
{% load asset_tags %}






{% block title %}
    CDMB
{% endblock %}


{% block navbar_left %}

    <!-- 驗證用戶部門(admin)  -->
    {% verify_permissions request as admin_dent %}

    {% verify_dent request 'IT' as ITdent %}

    {% if admin_dent or ITdent %}

        <li class="active"><a href="{% url 'asset' %}">資產</a></li>
        <li><a href="{% url 'host' %}">運維</a></li>

    {% else %}

        <li class="active"><a href="{% url 'asset' %}">資產</a></li>

    {% endif %}

{% endblock %}


{% block sideber_menu %}


    {% url 'asset' as asset %}
    {% url 'asset_index' as asset_index %}
    {% url 'asset_input' as asset_input %}

    {% url 'asset_repair' as asset_repair %}
    {% url 'asset_repair_add' as asset_repair_add %}

    {% url 'host' as host %}

    {% url 'user' as user %}
    {% url 'user_input' as user_input %}

    {% url 'category' as category %}
    {% url 'category_input' as category_input %}

    {% url 'department' as department %}
    {% url 'department_input' as department_input %}




    <!--- sidebar 選單 -->
    {% verify_permissions request as admin_dent %}

    {% if admin_dent %}



        <!--- nav-sidebar -->
        <ul class="nav nav-sidebar">


            <ul class="list-group">

                <li class="list-group-item">
                    <a href={{ asset }}><i class="fa fa-home"></i> 資產首頁</a>
                </li>


                <!-- 資產管理 -->
                <li class="list-group-item">
                    <a href="#assetSubmenu" data-toggle="collapse" aria-expanded="false"
                       class="dropdown-toggle collapsed"><span> <i
                            class="fa fa-box"></i> 資產管理</span><span style="float:right"><i
                            class="fa fa-angle-right"></i></span></a>

                    <ul class="list-unstyled collapse" id="assetSubmenu" style="">
                        <li {% if request.path == asset_index %}
                            class="active"{% endif %}><a href={{ asset_index }}>資產列表</a></li>


                        <li {% if request.path == asset_repair %}class="active"{% endif %}><a
                                href="{{ asset_repair }}">資產維修紀錄表</a>
                        </li>


                        <li {% if request.path == asset_input %}class="active"{% endif %}><a
                                href="{{ asset_input }}">匯入</a>
                        </li>
                        <li><a href="{% url 'asset_output' %}" target="_blank">匯出</a></li>
                    </ul>
                </li>


                <!--- 用戶管理 -->
                <li class="list-group-item">
                    <a href="#userSubmenu" data-toggle="collapse" aria-expanded="false"
                       class="dropdown-toggle collapsed">
                        <span><i class="fa fa-users"></i> 用戶管理</span>
                        <span style="float:right"><i class="fa fa-angle-right"></i></span></a>

                    <ul class="list-unstyled collapse" id="userSubmenu" style="">
                        <li {% if request.path == user %}class="active"{% endif %}><a href={{ user }}>用戶列表</a></li>
                        <li {% if request.path == user_input %}class="active"{% endif %}><a
                                href="{{ user_input }}">匯入</a>
                        </li>
                        <li><a href="{% url 'user_output' %}" target="_blank">匯出</a></li>

                    </ul>
                </li>


                <!--- 部門管理 -->
                <li class="list-group-item">
                    <a href="#dentSubmenu" data-toggle="collapse" aria-expanded="false"
                       class="dropdown-toggle collapsed">
                        <span><i class="fa fa-sitemap"></i> 部門管理</span>
                        <span style="float:right"><i class="fa fa-angle-right"></i></span></a>

                    <ul class="list-unstyled collapse" id="dentSubmenu" style="">
                        <li {% if request.path == department %}class="active"{% endif %}><a
                                href={{ department }}>部門列表</a>
                        </li>

                        <li {% if request.path == category_input %}class="active"{% endif %}><a
                                href="{{ category_input }}">匯入</a></li>
                        <li><a href="{% url 'category_output' %}" target="_blank">匯出</a></li>

                    </ul>
                </li>


                <!--- 類型管理 -->
                <li class="list-group-item">
                    <a href="#categorySubmenu" data-toggle="collapse" aria-expanded="false"
                       class="dropdown-toggle collapsed">
                        <span><i class="fa fa-th"></i> 類型管理</span>
                        <span style="float:right"><i class="fa fa-angle-right"></i></span></a>

                    <ul class="list-unstyled collapse" id="categorySubmenu" style="">
                        <li {% if request.path == category %}class="active"{% endif %}><a href={{ category }}>類型列表</a>
                        </li>

                        <li {% if request.path == category_input %}class="active"{% endif %}><a
                                href="{{ category_input }}">匯入</a></li>
                        <li><a href="{% url 'category_output' %}" target="_blank">匯出</a></li>

                    </ul>
                </li>
            </ul>

        </ul>
    {% else %}

        <!--- nav-sidebar -->
        <ul class="nav nav-sidebar">

            <ul class="list-group">


                <a href="{{ asset }}"
                   class="list-group-item {% if request.path == asset %}active{% endif %}">
                <span>
                    <i class="fa fa-box"></i> 資產首頁
                </span>
                </a>


                <a href="{{ asset_index }}"
                   class="list-group-item {% if request.path == asset_index %}active{% endif %}">
                <span>
                    <i class="fa fa-box"></i> 資產列表
                </span>
                </a>

                <a href="{{ asset_repair }}"
                   class="list-group-item {% if request.path == asset_repair %}active{% endif %}">
                <span>
                    <i class="fa fa-box"></i> 資產維修紀錄
                </span>
                </a>

                <a href="{{ asset_repair_add }}"
                   class="list-group-item {% if request.path == asset_repair_add %}active{% endif %}">
                <span>
                    <i class="fa fa-box"></i> 新增資產維修紀錄
                </span>
                </a>


            </ul>

        </ul>

    {% endif %}






{% endblock %}


{% block content %}



{% endblock %}


{% block base-js %}


    <script>


        // 日期
        $('#id_purchase_date').datepicker(
            {
                language: 'zh-TW',
                format: "yyyy-mm-dd",
                todayHighlight: true,

            });


        // 選擇部門後請求關聯使用資料
        function get_dent_user(e) {
            //console.log(e);
            //console.log($(this));
            //console.log(e.value);

            $.ajax({
                url: "/api/dent_user",
                type: "GET",
                data: {'dent': e.value},
                async: false,

                success: function (callback) {
                    window.dent_user = {
                        'status': 'ok',
                        'data': callback
                    };
                    console.log(window.dent_user);
                },
                error: function () {

                }
            });
        };


        // 新增資產 關聯用戶
        function add_assetform_user(e) {
            get_dent_user(e);
            dent_user = window.dent_user;
            //console.log(dent_user);
            if (dent_user.status == 'ok') {
                // 解開#user_add select選項 disabled
                $("#id_manager").removeAttr("disabled");

                console.log('add_assetform_user');

                $("#id_manager").find('option')
                    .remove()
                    .end()
                    .append('<option value="">--------</option>')
                    .val('')
                ;

                var users = dent_user.data.users;
                var owner = dent_user.data.owner;


                $.each(users, function (i, item) {
                    console.log(item);

                    $("#id_manager").append($('<option>', {
                            value: item.id,
                            text: item.name
                        }
                    ));

                    if (owner) {
                        $("#id_manager").val(owner)
                    }

                })
            }
        };


        // 檢查狀態
        function ch_status_ele(e) {

            if (e.value == "使用中") {
                $("#id_department").removeAttr("disabled").val("");
                $("#id_manager").removeAttr("disabled").val("");


            } else {
                $("#id_department").attr("disabled", "disabled").val("");
                $("#id_manager").attr("disabled", "disabled").val("");

            }

        }

    </script>


{% endblock %}

